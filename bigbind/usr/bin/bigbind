#!/bin/bash

#Manage Bind
#
#Authors:
#  Bruno Goncalves Araujo <www.biglinux.com.br>
#
#License: GPLv2 or later
#################################################


#Check permission
if test $(id -u) != 0
then
    echo "Need root permission"
    exit 0
fi


#Options
case "$1" in

    --start)
	/etc/init.d/bind9 start
	exit 0
    ;;

    --stop)
	/etc/init.d/bind9 stop
	exit 0
    ;;

    --autostart)
	update-rc.d -f bind9 defaults
        exit 0
    ;;

    --disable-autostart)
      update-rc.d -f bind9 remove
      exit 0
    ;;


    --fix-resolvconf)
      chattr -i /etc/resolvconf/resolv.conf.d/head
      echo '# Generated by BigBind
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
# DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN' > /etc/resolvconf/resolv.conf.d/head
      for i in $(echo "$*" |cut -d" " -f2,3,4,5,6,7,8,9)
      do
      echo "nameserver $i" >> /etc/resolvconf/resolv.conf.d/head
      done
      chattr +i /etc/resolvconf/resolv.conf.d/head
      resolvconf -u
      exit 0
    ;;

    --unfix-resolvconf)
      chattr -i /etc/resolvconf/resolv.conf.d/head
      echo '# Generated by BigBind
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
# DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN' > /etc/resolvconf/resolv.conf.d/head
      resolvconf -u
      exit 0
    ;;


    *)
        echo "Manage Bind

--start
--stop
--autostart
--disable-autostart
--fix-resolvconf 208.67.222.222 208.67.220.220		 Example for use OpenDNS
--unfix-resolvconf
"

    ;;

esac

